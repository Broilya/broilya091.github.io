(window.p=window.p||[]).push([[46],{1339:function(t,e,r){"use strict";r.r(e);var n=r(7),o=r(212),i=r(1),s=r(27),a=r(5),c=r(9),u=r(65),l=r(1347),d=r(25),p=r(3),y=function(){function LastMessagesQuery(t){this.chatIds=t}return i.__decorate([Object(p.serializable)(Object(p.list)(Object(p.primitive)()))],LastMessagesQuery.prototype,"chatIds",void 0),LastMessagesQuery}(),h=r(1353),f=r(1455),m=function(){function HistoryListStore(){var t=this;this.nextTxnId=null,this.nextTxnDate=null,this.items=[],this.loading=!1,Object(a.reaction)(function(){return t.filter},function(){return t.changeFilter()},{fireImmediately:!0})}return HistoryListStore.prototype.init=function(){},HistoryListStore.prototype.changeFilter=function(){this.filter&&(this.nextTxnId=null,this.nextTxnDate=null,this.items=[],this.loadCount=0,this.load())},HistoryListStore.prototype.load=function(){var i=this;this.user.valid&&(this.loading=!0,this.historyService.getItems(this.user.id,this.rows,this.nextTxnId,this.nextTxnDate,this.filter).then(function(e){var t=e.items.filter(function(t){return t.features.chatAvailable});return 0===t.length?[e,{}]:i.paymentChatService.getLastMessages(new y(t.map(function(t){return t.txnId}))).then(function(t){return[e,t]}).catch(function(){return[e,{}]})}).then(function(t){var e=t[0],r=t[1];return Promise.all(e.items.map(function(t){return i.loadItem(t,r[t.txnId])})).then(function(t){return[t,e.nextTxnId,e.nextTxnDate]})}).then(function(t){var e=t[0],r=t[1],o=t[2];return i.loadSuccess(e,r,o)}).catch(function(t){return i.loadError(t)}))},HistoryListStore.prototype.loadSuccess=function(t,e,r){this.loading=!1,this.error=void 0,this.nextTxnId=e,this.nextTxnDate=r,this.items=this.items.concat(t),this.loadCount+=1},HistoryListStore.prototype.loadError=function(t){this.loading=!1,this.error=t},HistoryListStore.prototype.loadItem=function(e,r){var o=this;return this.asyncItem().then(function(t){return o.loadItemSuccess(e,r,t)})},HistoryListStore.prototype.loadItemSuccess=function(t,e,r){var o=r.get(n.Store);return o.item=t,o.lastMessage=e,r},Object.defineProperty(HistoryListStore.prototype,"empty",{get:function(){return 0===this.items.length},enumerable:!0,configurable:!0}),Object.defineProperty(HistoryListStore.prototype,"groups",{get:function(){return this.items.reduce(function(t,e){var r=e.get(n.Store).item,o=new Date(Object(c.getYear)(r.date),Object(c.getMonth)(r.date),Object(c.getDate)(r.date)),i=t.find(function(t){return 0===Object(c.compareAsc)(t.date,o)});return null==i?t.push(new l.c(o,[e])):i.items.push(e),t},[])},enumerable:!0,configurable:!0}),Object.defineProperty(HistoryListStore.prototype,"firstTxnId",{get:function(){var e=this;return this.items.some(function(t){return t.get(n.Store).item.txnId===e.user.firstTxnId})},enumerable:!0,configurable:!0}),Object.defineProperty(HistoryListStore.prototype,"identificationErrors",{get:function(){return this.user.valid&&this.user.identificationLevel[u.a.QIWI]===d.a.SIMPLE&&this.items.some(function(t){return[866,867,868,869].includes(t.get(n.Store).item.errorCode)})},enumerable:!0,configurable:!0}),i.__decorate([Object(s.inject)(h.a)],HistoryListStore.prototype,"historyService",void 0),i.__decorate([Object(s.inject)(f.a)],HistoryListStore.prototype,"paymentChatService",void 0),i.__decorate([Object(s.inject)(n.User)],HistoryListStore.prototype,"user",void 0),i.__decorate([Object(s.inject)("Item")],HistoryListStore.prototype,"asyncItem",void 0),i.__decorate([a.observable],HistoryListStore.prototype,"rows",void 0),i.__decorate([a.observable],HistoryListStore.prototype,"filter",void 0),i.__decorate([a.observable],HistoryListStore.prototype,"nextTxnId",void 0),i.__decorate([a.observable],HistoryListStore.prototype,"nextTxnDate",void 0),i.__decorate([a.observable],HistoryListStore.prototype,"loadCount",void 0),i.__decorate([a.observable],HistoryListStore.prototype,"items",void 0),i.__decorate([a.observable],HistoryListStore.prototype,"loading",void 0),i.__decorate([a.observable],HistoryListStore.prototype,"error",void 0),i.__decorate([Object(s.postConstruct)(),a.action],HistoryListStore.prototype,"init",null),i.__decorate([a.action],HistoryListStore.prototype,"changeFilter",null),i.__decorate([a.action],HistoryListStore.prototype,"load",null),i.__decorate([a.action],HistoryListStore.prototype,"loadSuccess",null),i.__decorate([a.action],HistoryListStore.prototype,"loadError",null),i.__decorate([a.action],HistoryListStore.prototype,"loadItem",null),i.__decorate([a.action],HistoryListStore.prototype,"loadItemSuccess",null),i.__decorate([a.computed],HistoryListStore.prototype,"empty",null),i.__decorate([a.computed],HistoryListStore.prototype,"groups",null),i.__decorate([a.computed],HistoryListStore.prototype,"firstTxnId",null),i.__decorate([a.computed],HistoryListStore.prototype,"identificationErrors",null),HistoryListStore=i.__decorate([Object(s.injectable)()],HistoryListStore)}(),b=r(0),_=r.n(b),S=r(18),v=r(20),g=r(96),H=r.n(g),L=r(4),x=r(12),j=r(2),I={self:i.__assign({},Object(j.l)(),Object(j.g)(20),{padding:[25,0,10],background:j.r.whiteColor,borderRadius:10}),date:{padding:[0,40,10],textTransform:"uppercase",letterSpacing:1.5,fontSize:13},dateValue:{margin:[0,15,0,0],fontWeight:600},dateDay:{fontWeight:500,opacity:.5}},O=function(t){function HistoryBlock(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(HistoryBlock,t),HistoryBlock.prototype.dayType=function(){var t=this.props.group;switch(Object(c.differenceInDays)(new Date,t.date)){case 0:return"Сегодня";case 1:return"Вчера"}return""},HistoryBlock.prototype.render=function(){var t=this.props,e=t.group,r=t.classes,o=this.dayType();return _.a.createElement("div",{className:r.self},_.a.createElement("div",{className:r.date},_.a.createElement("span",{className:r.dateValue},Object(c.format)(e.date,"D MMMM",{locale:H.a})),o?_.a.createElement("span",{className:r.dateDay},o):null),_.a.createElement("div",null,e.items.map(function(t,e){return _.a.createElement(x.mb,{key:e,container:t})})))},i.__decorate([Object(v.resolve)(n.Store)],HistoryBlock.prototype,"store",void 0),HistoryBlock=i.__decorate([Object(L.rb)(I),S.observer],HistoryBlock)}(L.bb),w=function(t){function HistoryListView(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(HistoryListView,t),HistoryListView.prototype.render=function(){return 0===this.store.groups.length?null:_.a.createElement(_.a.Fragment,null,this.store.groups.map(function(t,e){return _.a.createElement(O,{key:e,group:t})}))},i.__decorate([Object(v.resolve)(n.Store)],HistoryListView.prototype,"store",void 0),HistoryListView=i.__decorate([S.observer],HistoryListView)}(_.a.Component);e.default=function(t){var e=t.createChild();return e.bind(n.Store).to(m).inSingletonScope(),e.bind(n.View).toConstructor(w),e.bind("Item").toConstantValue(Object(o.i)(e)),e}}}]);